/**
 * A menu bar for the TeacherReportAssistant tra
 */

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;

import javax.swing.JCheckBoxMenuItem;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;

import openSaveControl.OpenSaveControl;

public class MenuBar extends JMenuBar
    implements ActionListener
{
  private TeacherReportAssistant tra;
  private JCheckBoxMenuItem insertAtCursor;
  private JMenuItem openNames, openSentenceTemplates, openDir, exit, showHelp, about;
  private JMenuItem save, saveAs;
  
  private OpenSaveControl openSaveControl;
  private TraOpenSaveControlClient traOpenSaveControlClient;

  public MenuBar(TeacherReportAssistant tra)
  {
    this.tra = tra;
 
    // "File" menu:

    JMenu fileMenu = new JMenu("File");
    fileMenu.setMnemonic('F');

    // Second level menu under "Preferences":
    JMenu preferences = new JMenu("Preferences");
    preferences.setMnemonic('P');
    insertAtCursor = new JCheckBoxMenuItem("Insert at cursor", false);
    insertAtCursor.setMnemonic('I');
    preferences.add(insertAtCursor);

    openNames  = new JMenuItem("Open Student Names ...");
    openNames.setMnemonic('N');
    openNames.addActionListener(this);

    openSentenceTemplates  = new JMenuItem("Open Sentence Templates ...");
    openSentenceTemplates.setMnemonic('S');
    openSentenceTemplates.addActionListener(this);

    openDir  = new JMenuItem("Open Directory ...");
    openDir.setMnemonic('O');
    openDir.addActionListener(this);
    

    save  = new JMenuItem("Save");
    save.setMnemonic('S');
    save.addActionListener(this);  

    saveAs  = new JMenuItem("Save As ...");
    //save.setMnemonic('S');
    saveAs.addActionListener(this);
    
    

    exit = new JMenuItem("Exit");
    exit.setMnemonic('x');
    exit.addActionListener(this);

    fileMenu.add(preferences);
    fileMenu.addSeparator();
    fileMenu.add(openNames);
    fileMenu.add(openSentenceTemplates);
    fileMenu.add(openDir);
    fileMenu.addSeparator();
    fileMenu.add(save);
    fileMenu.add(saveAs);
    fileMenu.addSeparator();
    fileMenu.add(exit);

    add(fileMenu);

    // "Help" menu:

    JMenu helpMenu = new JMenu("Help");
    helpMenu.setMnemonic('H');

    showHelp = new JMenuItem("Help ...");
    showHelp.setMnemonic('H');
    showHelp.addActionListener(this);

    about = new JMenuItem("About...");
    about.setMnemonic('A');
    about.addActionListener(this);

    helpMenu.add(showHelp);
    helpMenu.add(about);

    add(helpMenu);
    
    // Must be instantiated after the menu items exist
    traOpenSaveControlClient = new TraOpenSaveControlClient(tra);
    openSaveControl=new OpenSaveControl(tra,traOpenSaveControlClient);
    
    // Save and SaveAs are not available until after OpenDir or OpenSentenceTemplates are done.
    // This could be changed so that save is only available when there are some changes to the editable text.
    save.setEnabled(false);
    saveAs.setEnabled(false);

    // Names file must be opened before SentenceTemplates file.
    openSentenceTemplates.setEnabled(false);
  }

  public boolean insertAtCursorEnabled()
  {
    return insertAtCursor.isSelected();
  }

  public void actionPerformed(ActionEvent e)
  {
    JMenuItem src = (JMenuItem)e.getSource();

    if (src == openNames) {
    	openSaveControl.doOpenNames();
      }
    else if (src == openSentenceTemplates) {
    	openSaveControl.doOpenSentenceTemplates();
    }
    else if (src == openDir) {
        openSaveControl.doOpen();
    }
    else if (src ==save){
      openSaveControl.doSave();
    }
    else if (src ==saveAs){
      openSaveControl.doSaveAs();
    }
    else if (src == showHelp)
      new HelpMenuBar().showHelp();
    else if (src == about)
      HelpMenuBar.showAbout();
    else if (src == exit) {
      tra.updateStudentReportFromEditableText();
      System.out.println(tra.getReports());
      System.exit(0);
    }
  }
  
  

  // Enable/Disable File menu bar items
	public void enableOpenNamesMenuItem(Boolean b) {
		openNames.setEnabled(b);
	}
	public void enableOpenSentenceTemplatesMenuItem(Boolean b) {
		openSentenceTemplates.setEnabled(b);
	}
	
  public void enableSaveMenuItem(Boolean b) {
    save.setEnabled(b);
  }
  public void enableSaveAsMenuItem(Boolean b) {
     saveAs.setEnabled(b);
  }
}

